(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{497:function(s,t,e){"use strict";e.r(t);var a=e(4),n=Object(a.a)({},(function(){var s=this,t=s.$createElement,e=s._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("最近在工作中遇到一个问题. "),e("strong",[s._v("动态导入文件")])]),s._v(" "),e("p",[s._v("那我们怎么做到这一点呢, 我的想法是通过"),e("strong",[s._v("webpack")]),s._v("来实现")]),s._v(" "),e("p",[s._v("因为以前在做vue项目的时候遇到过这个情况, 如下所示:")]),s._v(" "),e("div",{staticClass:"language-javascript extra-class"},[e("pre",{pre:!0,attrs:{class:"language-javascript"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Vue "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vue'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" Vuex "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vuex'")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" getters "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./getters'")]),s._v("\n\nVue"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("use")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Vuex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// https://webpack.js.org/guides/dependency-management/#requirecontext")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" modulesFiles "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" require"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("context")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./modules'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token regex"}},[e("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("\\.js$")]),e("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// you do not need `import app from './modules/app'`")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// it will auto require all vuex module from modules file")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" modules "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" modulesFiles"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("keys")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("reduce")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("modules"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" modulePath")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// set './app.js' => 'app'")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" moduleName "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" modulePath"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("replace")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token regex"}},[e("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")]),e("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[s._v("^\\.\\/(.*)\\.\\w+$")]),e("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[s._v("/")])]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'$1'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" value "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("modulesFiles")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("modulePath"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  modules"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("moduleName"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" value"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("default\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" modules\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" store "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Vuex"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Store")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  modules"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  getters\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" store\n\n")])])]),e("p",[s._v("上面这段代码的作用就是把同级目录modules下的js文件全部取到, 然后通过自带的keys()方法遍历自动导入这些js文件")]),s._v(" "),e("hr"),s._v(" "),e("p",[s._v("上面代码中, 我们的主角就是 "),e("strong",[s._v("require.context")])]),s._v(" "),e("blockquote",[e("p",[s._v("require.context是Webpack中用来管理依赖的一个函数,此方法会生成一个上下文模块,包含目录下所有模块的引用,通过正则表达式匹配,然后require进来")])]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v(" require.context('.', false, /\\.vue$/)\n")])])]),e("p",[s._v("此方法有三个参数,\n参数一:要查询的目录,上述代码指的是当前目录\n参数二: 是否要查询子孙目录,方法默认的值为false\n参数三:要匹配的文件的后缀,是一个正则表达式,上述我要查询的是.vue文件")]),s._v(" "),e("p",[s._v("require.context模块返回一个函数，这个函数可以接收一个参数")]),s._v(" "),e("p",[s._v("导出的方法有 3 个属性： resolve, keys, id。\nresolve 是一个函数，它返回请求被解析后得到的模块 id。\nkeys 也是一个函数，它返回一个数组，由所有可能被上下文模块处理的请求组成。\nid 是上下文模块里面所包含的模块 id. 它可能在你使用 module.hot.accept 的时候被用到")]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"实现"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#实现"}},[s._v("#")]),s._v(" 实现")]),s._v(" "),e("p",[s._v("目录结构:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("|modules\n|—common\n|——common.js\n|—file\n|——file.js\n|—scan\n|——scan.js\n|bridge.js\n|index.js\n|package.json\n")])])]),e("p",[s._v("modules/scan/scan.js文件:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('import bridge from "../../bridge.js";\n\nexport default {\n  scan: params => {\n    return new Promise((resolve, reject) => {\n      bridge.callHandler("scan", [params], function (res) {\n        if (res.code == 1) {\n          resolve(res.data);\n        } else {\n          reject(res.message);\n        }\n      });\n    });\n  }\n};\n')])])]),e("p",[s._v("index.js文件:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const modulesFiles = require.context('./modules', true, /\\.js$/)\n\nconst modules = modulesFiles.keys().reduce((modules, modulePath) => {\n  const value = modulesFiles(modulePath).default\n  // 合并所有modules文件夹下的js export default {...}\n  modules = Object.assign({}, modules, value); \n  return modules\n}, {})\n\nexport default window.xhyBridge = modules;\n")])])]),e("p",[s._v("package.json文件:")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('{\n  "name": "bridge-demo",\n  "version": "1.0.0",\n  "description": "for bridge",\n  "main": "index.js",\n  "scripts": {\n    "test": "echo \\"Error: no test specified\\" && exit 1",\n    "start": "webpack index.js -o dist/xhyBridge.js"\n  },\n  "author": "zs",\n  "license": "ISC",\n  "devDependencies": {\n    "webpack": "^4.44.1",\n    "webpack-cli": "^3.3.12"\n  }\n}\n\n')])])]),e("p",[s._v("最后通过命令把index.js打包到dist/xhyBridge.js")]),s._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm start\n")])])]),e("p",[s._v('"how are you " " ̶s̶a̶d̶,̶ ̶b̶r̶o̶k̶e̶n̶,̶ ̶d̶e̶f̶e̶a̶t̶e̶d̶,̶ ̶c̶r̶u̶s̶h̶e̶d̶,̶ ̶l̶o̶n̶e̶l̶y̶,̶ ̶f̶a̶l̶l̶i̶n̶g̶ ̶a̶p̶a̶r̶t̶ i\'m fine. "')])])}),[],!1,null,null,null);t.default=n.exports}}]);